import{_ as n,V as s,W as a,a0 as e}from"./framework-f06be456.js";const t={},o=e(`<h1 id="sysmon" tabindex="-1"><a class="header-anchor" href="#sysmon" aria-hidden="true">#</a> sysmon</h1><p><code>sysmon</code>是一个普通的函数，直译为系统监控，去掉注释部分也就200来行代码。它会在程序引导阶段时被分配一个单独的线程来启动，之后会在后台不断地监控Go程序运行时的状态，并作出相应的处理。关于它启动这部分的代码可以在<code>runtime.main</code>函数中查看到：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
	mp <span class="token operator">:=</span> <span class="token function">getg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>m
	mainStarted <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token function">systemstack</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">newm</span><span class="token punctuation">(</span>sysmon<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>系统监控本身只是一个<code>for</code>循环，每一轮循环的间隔时间为20微秒，随着程序空闲指数的上升，间隔时间最多会提升至10毫秒。在每一轮循环中，它主要做了下面几件事情：</p><ul><li>辅助协程调度，抢占长时间运行的协程</li><li>检查内存情况，并判断是否需要进行垃圾回收</li></ul>`,5),p=[o];function c(i,l){return s(),a("div",null,p)}const d=n(t,[["render",c],["__file","15.sysmon.html.vue"]]);export{d as default};
